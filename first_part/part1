#!/bin/sh

#Создать функцию на bash, которая будет принимать на вход
#список репозиториев, скачав каждую ветку в отдельную папку,
#если уже были скачены, то обновить до последней версии, создать
#внутри файлик с текущей датой и временем, именем репозитория и веткой,
#в которой находится, залить этот файлик в репозиторий.

#Получение пути исполняемого файла
main_dir=${0%/*} #путь исполняемого файла (выводит путь исполняемого файла только при условии, что файл запущен из домашней директории)
#Считывание ссылок
while true; do
#Вывод приглашения для ввода
	echo -n 'Введите строку (введите пустую строку для завершения): '

#Cчитывание строки в переменную
	read read_repo_link
#Проверка
	if [ -z "$read_repo_link" ]; then
		echo 'Введена пустая строка. Завершение.'
		break
	else
#Очистка от "шелухи"
		repo_link_wd=${read_repo_link//./}
		repo_link_wgit=${repo_link_wd%git}
		repo_name=${repo_link_wgit##*/}

		repo_path=$main_dir/$repo_name
#Обновление старых репозиториев с фиксированием обновления в файле изменений
		if [[ -d "$repo_path" ]]; then
			echo 'Обновление'
			cd $repo_path && git pull
			printf -v now '%(%Y_%m_%d_%H_%M_%S)T' '-1' #-1 означает текущее время (-2 время вызова оболочки)
			touch $repo_name'_changes.txt'
			printf "Репозиторий $repo_name был обновлён $now \n" >> $repo_name'_changes.txt'
#Клонирование новых репозиториев
		else 
			echo 'Загрузка'
			cd $main_dir && git clone $read_repo_link
		fi
	fi
	cd $HOME
	echo ''
done
